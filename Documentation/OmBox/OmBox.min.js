function OmBox(a,b){this.window="object"==typeof a?a:document.getElementById(a),"undefined"==typeof b&&(b=OMBOX_DEFAULT),this.parseCustomize(b),this.overlay&&this.overlayCreate();for(var c=document.getElementsByTagName("script"),d=0;d<c.length;d++){var e=c[d].src.split("OmBox.js");2===e.length&&(this.serverLocation=e[0])}this.init()}function touchHandler(a){var b=a.changedTouches[0],c=document.createEvent("MouseEvent");c.initMouseEvent({touchstart:"mousedown",touchmove:"mousemove",touchend:"mouseup"}[a.type],!0,!0,window,1,b.screenX,b.screenY,b.clientX,b.clientY,!1,!1,!1,!1,0,null),b.target.dispatchEvent(c),a.preventDefault()}function touchDefault(a){a.addEventListener("touchstart",touchHandler,!0),a.addEventListener("touchmove",touchHandler,!0),a.addEventListener("touchend",touchHandler,!0),a.addEventListener("touchcancel",touchHandler,!0)}function getMouseXY(a){var b={};return isset(a)?(b.x=a.pageX,b.y=a.pageY):(b.x=event.clientX+document.body.scrollLeft,b.y=event.clientY+document.body.scrollTop),b.x<0&&(b.x=0),b.y<0&&(b.y=0),b}function isset(a){return"undefined"==typeof a?!1:null==a?!1:!0}function in_array(a,b,c){var d="",e=!!c;if(e){for(d in b)if(b[d]===a)return!0}else for(d in b)if(b[d]==a)return!0;return!1}var OmBoxThemes=[],OmBoxes=[],OMBOX_DEFAULT={theme:"OmDefault",title:"",resizeable:!0,classOn:"OmBoxSlideOn",classOff:"OmBoxSlideOff",deleteButton:!0,fullSizeButton:!0,outButton:!0,footer:!0,top:20,overlay:!1,showDefault:!1};OmBox.prototype={init:function(){OmBoxes.length<1&&this.loadTheme("OmBoxCore"),this.contentInit(),this.headerCreate(),this.footer&&this.footerCreate(),this.buttonEnable(),this.setTheme(this.theme),this.clear(),OmBoxes.push(this);var a="ontouchstart"in window;return a&&this.mobileSetup(),this.showDefault&&this.show(),this},contentInit:function(){this.contents=this.window.getElementsByTagName("div")[0],isset(this.contents)||(this.contents=document.createElement("div"),this.window.appendChild(this.contents))},headerCreate:function(){this.boxTop=document.createElement("div"),this.controlsWrap=document.createElement("span"),this.moveAbleWrap=document.createElement("a"),this.moveAbleWrap.href="javascript:void(0)",this.titleElement=document.createElement("h3"),this.titleElement.innerHTML=this.title,this.deleteButton&&(this.deleteButton=document.createElement("a"),this.deleteButton.href="javascript:void(0)",this.controlsWrap.appendChild(this.deleteButton)),this.fullSizeButton&&(this.fullSizeButton=document.createElement("a"),this.fullSizeButton.href="javascript:void(0)",this.controlsWrap.appendChild(this.fullSizeButton)),this.outButton&&(this.outButton=document.createElement("a"),this.outButton.href="javascript:void(0)",this.controlsWrap.appendChild(this.outButton)),this.boxTop.appendChild(this.controlsWrap),this.moveAbleWrap.appendChild(this.titleElement),this.boxTop.appendChild(this.moveAbleWrap),this.window.insertBefore(this.boxTop,this.window.firstChild)},footerCreate:function(){this.footer=document.createElement("div"),this.footer.className=this.theme+"Footer",this.resizeHandle=document.createElement("a"),this.resizeHandle.href="javascript:void(0)",this.footer.appendChild(this.resizeHandle),this.window.appendChild(this.footer)},buttonEnable:function(){var a=this;this.moveable(this.boxTop),this.deleteButton&&(this.deleteButton.onclick=function(){a.close()}),this.fullSizeButton&&(this.fullSizeButton.onclick=function(){a.fullSize()}),this.outButton&&(this.outButton.onclick=function(){a.moveOut()}),this.resizeHandle&&this.resize(this.resizeHandle),this.window.onclick=function(){a.zTop()}},show:function(){this.window.style.display="block",this.zTop(),this.overlay&&(this.overlay.style.display="block");var a=this;setTimeout(function(){return isset(this.window.classList)?(a.window.classList.remove(a.classOff),void a.window.classList.add(a.classOn)):(a.window.className=a.theme+" "+a.classOn,!0)},100);var b=document.documentElement,c=(window.pageYOffset||b.scrollTop)-(b.clientTop||0);this.window.style.top=c+this.top+"px",this.isOpen=1},close:function(){isset(this.window.classList)?(this.window.classList.remove(this.classOn),this.window.classList.add(this.classOff)):this.window.className=this.theme+" "+this.classOff;var a=this;this.overlay&&(a.overlay.style.display="none"),setTimeout(function(){a.window.style.display="none",this.isOpen=0},1e3)},refresh:function(a){var b=this;this.close(),setTimeout(function(){b.show()},parseInt(a))},clear:function(){return this.window.style.display="none",isset(this.window.classList)?(this.window.classList.remove(this.classOn),this.window.classList.add(this.classOff),void(this.isOpen=0)):(this.window.className=this.theme+" "+this.classOff,!0)},zTop:function(){for(var a=0,b=0;b<OmBoxes.length;b++)0===a&&(a=OmBoxes[b].window.style.zIndex||5),parseInt(OmBoxes[b].window.style.zIndex)>a&&(a=OmBoxes[b].window.style.zIndex);this.overlay&&(this.overlay.style.zIndex=++a),this.window.style.zIndex=++a},overlayCreate:function(){this.overlay=document.createElement("div"),this.overlay.className="OmBoxOverlay",this.overlay.display="none",document.body.appendChild(this.overlay)},fullSize:function(){"100%"==this.window.style.width?(this.window.style.top="10px",this.window.style.width="90%",this.window.style.height="80%",this.moveable(this.boxTop)):(this.window.style.top="0",this.window.style.left="0",this.window.style.width="100%",this.window.style.height="96%",this.boxTop.onmousedown=!1)},moveOut:function(){var a=window.open("","mywindow","width=600,height=600");a.document.body.innerHTML=this.contents.innerHTML},moveable:function(a){var b=this;a.onmousedown=function(c){this.mouseDown++,b.move(c),isset(c)&&c.preventDefault(),document.body.onclick=function(){b.stopMove(a)}},window.onmouseup=function(){b.stopMove(a)}},move:function(a){this.zTop();var b=this,c=getMouseXY(a),d=c.x,e=c.y;document.body.onmousemove=function(a){var c=getMouseXY(a),f=d-c.x,g=b.window.style.left.split("px")[0]-1.3*f;g=g.toString().substr(0,6);var h=e-c.y,i=b.window.style.top.split("px")[0]-1*h;i=i.toString().substr(0,6),b.window.style.left=g+"px",b.window.style.top=i+"px",d=c.x,e=c.y}},stopMove:function(a){a.onmousedown=null,document.body.onmousemove=null,document.body.onclick=null,this.moveable(a)},resize:function(a){this.resizeEl=a;var b=this;this.resizeEl.onmousedown=function(a){b.resizeMouseWatch(a),isset(a)&&a.preventDefault(),window.onmouseup=function(){b.stopResize(b.resizeEl)},document.body.onclick=function(){b.stopResize(b.resizeEl)}}},resizeMouseWatch:function(a){var b=this,c=getMouseXY(a),d=b.window.offsetWidth,e=b.window.clientHeight-50,f=(b.window.offsetTop,b.window.style.top.split("px")[0],c.x),g=c.y;document.body.onmousemove=function(a){var c=getMouseXY(a),h=2*(f-c.x),i=d-h,j=g-c.y,k=e-j;b.window.style.width=i+"px",b.window.style.height=k+"px"}},stopResize:function(a){a.onmousedown=null,document.body.onmousemove=null,document.body.onclick=null,this.resize(a)}},OmBox.prototype.setData=function(a){return"object"==typeof a?(this.contents.innerHTML="",this.contents.appendChild(a),!0):void(this.contents.innerHTML=a)},OmBox.prototype.getData=function(){return this.contents},OmBox.prototype.setTheme=function(a){return isset(a)?(in_array(a,OmBoxThemes)||this.loadTheme(a),this.theme=a,this.window.className=a,this.boxTop.className=a+"Top",this.contents.className=a+"Content",this.deleteButton&&(this.deleteButton.className=a+"X"),this.fullSizeButton&&(this.fullSizeButton.className=a+"Full"),this.outButton&&(this.outButton.className=a+"Out"),this.footer&&(this.footer.className=a+"Footer"),void(this.resizeHandle&&(this.resizeHandle.className=this.theme+"Handle"))):(console.log("Theme is empty"),!1)},OmBox.prototype.loadTheme=function(a){if(!in_array(a,this.themes)){var b=this.serverLocation+"_themes/"+a+".css";if(isset(b)){var c=document.createElement("link");c.href=b,c.rel="stylesheet",isset(document.head)?document.head.appendChild(c):document.body.insertBefore(c,document.body.firstChild)}OmBoxThemes.push(a)}},OmBox.prototype.parseCustomize=function(a){for(var b=["theme","title","resizeable","classOn","classOff","deleteButton","fullSizeButton","outButton","footer","top","overlay","showDefault"],c=0;c<b.length;c++){var d=b[c];this[d]=isset(a[b[c]])?a[d]:OMBOX_DEFAULT[d]}},OmBox.prototype.mobileSetup=function(){touchDefault(this.boxTop),this.footer&&touchDefault(this.footer);var a=this;this.deleteButton&&(this.deleteButton.ontouchstart=function(){a.close()}),this.fullSizeButton&&(this.fullSizeButton.ontouchstart=function(){a.fullSize()}),this.outButton&&(this.outButton.ontouchstart=function(){a.moveOut()})};